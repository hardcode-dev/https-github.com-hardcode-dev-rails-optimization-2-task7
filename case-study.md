# ДЗ № 7  

## Оптимизация DX метрик 
 
В рамках данного ДЗ я решил занятся оптимизацией моего рабочего проекта так как у нас есть явные проблемы в прогоне тестов.
 
### Описание текущего сосотояния

Немного информации о текущем состоянии тестов на проекте: 

- Для тестирования мы используем `Rspec`
- Кол-во тест кейсов: `1450`
- Покрытие тестами: `99.68%`
- Время выполнения всех тестов: примерно `11 minutes 26 seconds` (`686 sec`)

### Сбор DX-метрик.  

Для того, что бы следить за прогресом в оптимизации тестов, для начала я решил настроить сбор и визуализацию DX-метрик с помощью `Influxer`.
Для визуализации этих метрик, я решил использовать `Chronograf`, так же как это было описано во время лекции. 

Проведя несколько тестовых и прогнав реальные тесты я получил исходные данные для ткущего состояния: http://joxi.ru/xAeBvzWHgaKwzr

Первый прогон дал результат: `740 sec` ( `12 minutes 20 seconds` )

### Оптимизация  

#### Точка роста №1  

На первом шаге я решил воспользоваться встроенным профилировщиком в `rspec`. 

Результат прогона указал на то, что самые медленные `test-suites` объеденяет одна особенность -- все они связаны с проверкой моделей, которые используют `uploader` для хагрузки изображений. 
В фабриках как я и ожидал(правдивее сказать знал) было указано загружать файл при каждом создании записи.
 
Перед проведением оптимизации я решил глубже изучить инструмент, который я использую для аплоадинга изображений в своем приложении. 
И с удивлением для себя обнаружил, что разработчики позаботились о тех кто использует их труд у себя в проекте и добавили в документацию описание того как можно замокать все внутренние процессы их либы так, что бы не пришлось процессить и грузить файл, а только эмитировать это все. 
К несчастью для меня дока расчитана на свежую версию библиотеки, и не до конца подходила под ту что использую я. Тем не менее изучив предыдущие версии этой доки и взяв только те вещи, которые мне подходят и необходимы, я смог замокать все места которые тормозили мои тесты.  
После внедрения изменений, я еще раз выполнил тесты что бы убедится, что ничего не сломалось. И уже на этом этапе я увидел явное улучшение, так как у меня по дефолту выводится время прогонов тестов в консоли.  

Результат оптимизации оказался намного лучше чем я ожидал: `180 sec` ( `3 minutes 00 seconds` ) 
Даже когда пишу эти цифры, для меня все еще удивительно, что я сократил время прогона тестов в 4(!!!) раза с помощью только одного изменения

Скриншот из `Chronograf`: http://joxi.ru/5mdBvj6HeZM8gA

Прогнав, еще раз тесты с флогом `--profile` я убедился, что точка роста изменилась.


